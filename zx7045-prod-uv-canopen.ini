#INCLUDE layout2.inc



[EMC]
# The version string for this INI file.
VERSION = 1.1

MACHINE = zx7045-prod 
#DEBUG = 0x902
DEBUG = 0

[DISPLAY]
DISPLAY = probe_basic

CYCLE_TIME = 0.05

CONFIRM_EXIT = false
;FULLSCREEN = false
;MAXIMIZE = false
;POSITION=0x0

INTRO_GRAPHIC = linuxcnc.gif
INTRO_TIME = 1

PROGRAM_PREFIX = /media/mule/barn/Documents/7-Projects/1-Electronics/cnc
OPEN_FILE=""

INCREMENTS = 5mm 1mm .5mm .1mm .05mm .01mm .005mm


POSITION_OFFSET = RELATIVE
POSITION_FEEDBACK = ACTUAL

MAX_FEED_OVERRIDE = 3.000000
MAX_RAPID_OVERRIDE = 3.000000

# velocity settings for Jogging
DEFAULT_LINEAR_VELOCITY = 15.0000
MAX_LINEAR_VELOCITY = 150.0000 
MIN_LINEAR_VELOCITY = 0.010000

# velocity settings for Jogging
DEFAULT_ANGULAR_VELOCITY = 10.0
MAX_ANGULAR_VELOCITY = 25.000000
MIN_ANGULAR_VELOCITY = 0.010000

DEFAULT_SPINDLE_SPEED = 0
MAX_SPINDLE_OVERRIDE = 2.000000
MIN_SPINDLE_OVERRIDE = 0.500000



EDITOR = gvim
GEOMETRY = xyzac
#EMBED_TAB_NAME=Probe Screen 
#EMBED_TAB_LOCATION = ntb_user_tabs
#EMBED_TAB_COMMAND = gladevcp  -x {XID} -u python/probe_screen.py probe_icons/probe_screen.glade 
TKPKG             = Ngcgui    1.0
TKPKG             = Ngcguittt 1.0

NGCGUI_FONT       = Helvetica -12 normal
# specify filenames only, files must be in [RS274NGC]SUBROUTINE_PATH
#NGCGUI_PREAMBLE   = 
#NGCGUI_SUBFILE    = tool-setter.ngc
#NGCGUI_SUBFILE    = p-calibrate.ngc
#NGCGUI_SUBFILE    = facemill2.ngc
# specify "" for a custom tab page
#######NGCGUI_SUBFILE    = ""
#NGCGUI_SUBFILE   = "" use when image frame is specified if
#                      opening other files is required
#                      images will be put in a top level window
NGCGUI_OPTIONS    = nonew noremove
#NGCGUI_OPTIONS   = opt1 opt2 ...
# opt items:
#   nonew      -- disallow making a new custom tab
#   noremove   -- disallow removing any tab page
#   noauto     -- no auto send (makeFile, then manually send)
#   noiframe   -- no internal image, image on separate top level

TTT               = truetype-tracer
#TTT_PREAMBLE      = in_std.ngc
USER_COMMAND_FILE=axisrc





[FILTER]
PROGRAM_EXTENSION = .png,.gif,.jpg Greyscale Depth Image
PROGRAM_EXTENSION = .py Python Script
png = image-to-gcode
gif = image-to-gcode
jpg = image-to-gcode
py = python




[RS274NGC]
PARAMETER_FILE = linuxcnc.var
FEATURES=30
# Remap M6
ON_ABORT_COMMAND=o<on_abort> call 
RS274NGC_STARTUP_CODE=F1000 S0
#SUBROUTINE_PATH =  macros:macros/atc:macros/probe:macros/utils:gladevcp/nc_files:../../../nc_files/ngcgui_lib:../../../nc_files/ngcgui_lib/utilitysubs
SUBROUTINE_PATH =  macros:macros/atc:macros/probe:macros/utils:gladevcp/nc_files
USER_M_PATH     = macros/mcode
REMAP=G55.4 modalgroup=1 ngc=dwo_on
REMAP=G55.5 modalgroup=1 ngc=dwo_off
ORIENT_OFFSET=240
#BELOW ARE MY REMAPPED M CODES FOR TOOLCHANGES
REMAP=M6  modalgroup=6  prolog=change_prolog   ngc=auto_tool_change  epilog=change_epilog

REMAP=M16 modalgroup=6  ngc=bind_spindle_tool_to_atc
REMAP=M17 modalgroup=6  ngc=unbind_spindle_tool_to_atc

REMAP=M10 modalgroup=6  ngc=drawbar_grab_tool
REMAP=M11 modalgroup=6  ngc=drawbar_release_tool

REMAP=M12 modalgroup=6            ngc=prev_pocket_left_atc
REMAP=M13 modalgroup=6            ngc=next_pocket_left_atc
REMAP=M14 modalgroup=6            ngc=prev_pocket_right_atc
REMAP=M15 modalgroup=6            ngc=next_pocket_right_atc

REMAP=M22 modalgroup=6            ngc=retract_left_atc
REMAP=M23 modalgroup=6  argspec=q ngc=extend_left_atc

REMAP=M24 modalgroup=6            ngc=retract_right_atc
REMAP=M25 modalgroup=6  argspec=q ngc=extend_right_atc

REMAP=M26 modalgroup=6  argspec=tdzlruf ngc=probe-tool

#REMAP=M10 modalgroup=6 argspec=p ngc=m10
#REMAP=M11 modalgroup=6 argspec=p ngc=m11
#REMAP=M13 modalgroup=6 ngc=m13
#REMAP=M21 modalgroup=6 ngc=m21
#REMAP=M22 modalgroup=6 ngc=m22
#REMAP=M23 modalgroup=6 ngc=m23
#REMAP=M24 modalgroup=6 ngc=m24
#REMAP=M25 modalgroup=6 ngc=m25
#REMAP=M26 modalgroup=6 ngc=m26

[ATC]
LEFT_POCKETS             = 18
LEFT_START_POCKET        = 1
LEFT_START_POCKET_POS    = 90
LEFT_DOUT_RETRACT        = 22
LEFT_DOUT_EXTEND         = 23
LEFT_DIN_TOOL_IN_POCKET  = 13
LEFT_SPINDLE_ORIENT      = 0

RIGHT_POCKETS            = 18
RIGHT_START_POCKET       = 19
RIGHT_START_POCKET_POS   = 270
RIGHT_DOUT_RETRACT       = 24
RIGHT_DOUT_EXTEND        = 25
RIGHT_DIN_TOOL_IN_POCKET = 17
RIGHT_SPINDLE_ORIENT     = 180

Z_FINE_POSITION   = -85
Z_FINE_FEED       =  400
Z_COARSE_POSITION = -74
Z_COARSE_FEED     =  6000

VAR_TOOL_IN_SPINDLE           = 4900
VAR_TOOL_IN_SPINDLE_ATC_BOUND = 4901
VAR_TOOLS_START               = 4902



[PYTHON]
TOPLEVEL=python/toplevel.py
PATH_APPEND=python

[EMCMOT]
EMCMOT = motmod
COMM_TIMEOUT = 1.0
SERVO_PERIOD = 1000000

[TASK]
TASK = milltask
CYCLE_TIME = 0.01

[HAL]
HALUI = halui
HALFILE = zx7045-prod.hal
HALFILE = custom.hal
HALFILE = LIB:xhc-hb04.tcl
POSTGUI_HALFILE = postgui_call_list.hal
SHUTDOWN = shutdown.hal

#[HALUI]  - see layout2.inc
#MDI_COMMAND=G0 x0 y0 z0
#MDI_COMMAND=o<home-spindle> call
#MDI_COMMAND=(debug, example: mdi-02)
#MDI_COMMAND=(debug, example: mdi-03)
#MDI_COMMAND=(debug, example: mdi-04)
#MDI_COMMAND=(debug, example: mdi-05)
#MDI_COMMAND=(debug, example: mdi-06)
#MDI_COMMAND=(debug, example: mdi-07)
#MDI_COMMAND=(debug, example: mdi-08)
#MDI_COMMAND=(debug, example: mdi-09)
#MDI_COMMAND=G53 G0 Z0
#MDI_COMMAND=(debug, example: mdi-11)
#MDI_COMMAND=G10 L20 P0 X0
#MDI_COMMAND=G10 L20 P0 Y0
#MDI_COMMAND=G10 L20 P0 Z0
#MDI_COMMAND=(debug, example: mdi-15)

[APPLICATIONS]
#APP = halshow my.halshow
#APP = halscope -i my.halscope


[TRAJ]
ARC_BLEND_ENABLE = 1
RC_BLEND_FALLBACK_ENABLE = 0
ARC_BLEND_OPTIMIZATION_DEPTH = 50
ARC_BLEND_GAP_CYCLES = 4
ARC_BLEND_RAMP_FREQ = 20
SPINDLES = 1
COORDINATES = X Y Z A C U V
AXES=5
JOINTS=7
LINEAR_UNITS = mm
ANGULAR_UNITS = degree
DEFAULT_VELOCITY = 80.00
MAX_VELOCITY = 100.0
DEFAULT_ACCELERATION = 200.0
MAX_ACCELERATION = 1000.0
POSITION_FILE = position_mm.txt
#NO_FORCE_HOMING = 1 

[EMCIO]
EMCIO = io
CYCLE_TIME = 0.100
TOOL_TABLE = tool.tbl
TOOL_CHANGE_QUILL_UP = 1
RANDOM_TOOLCHANGER = 0


[KINS]
#KINEMATICS = trivkins coordinates=XYZACUV
#KINEMATICS = xyzac-trt-kins
KINEMATICS = switchKins coordinates=XYZACUV
#KINEMATICS = xyzac-trt-kins sparm=identityfirst
JOINTS = 7


[XYZAC_KINS]
Y-OFFSET = -0.15
Z-OFFSET = -27.59
X-ROT-POINT = 407.855
Y-ROT-POINT = 154.260
#Z-ROT-POINT = -225.649
Z-ROT-POINT = -225.9

[AXIS_X]
MIN_LIMIT = 0.50
#MAX_LIMIT = 648.0
MAX_LIMIT = 642.0
#MAX_VELOCITY = 333.333333333 19000mm/min
MAX_VELOCITY = 100.0
MAX_ACCELERATION = 1000.0

[JOINT_0]
TYPE = LINEAR
FERROR = 0.5
MIN_FERROR = 0.05
#MAX_VELOCITY = 333.333333333 19000mm/min
MAX_VELOCITY = 100.0
#MAX_ACCELERATION = 2000.0
MAX_ACCELERATION = 1000.0
# The values below should be 25% larger than MAX_VELOCITY and MAX_ACCELERATION
# If using BACKLASH compensation STEPGEN_MAXACCEL should be 100% larger.
STEPGEN_MAXVEL = 610.7
STEPGEN_MAXACCEL = 6075.0
# these are in nanoseconds
DIRSETUP   = 200
DIRHOLD    = 200
STEPLEN    = 200
STEPSPACE  = 200
# step scale calculation 1024*8200/8192 * 2 (ratio 2:1) / 5 (ballscrew pitch)
STEP_SCALE = -410.0 
MIN_LIMIT = 0.50
MAX_LIMIT = 648.0
HOME=324.0
HOME_OFFSET = 0.5
HOME_SEARCH_VEL = -40.000000
HOME_LATCH_VEL = 0.5
HOME_FINAL_VEL = 70.000000
HOME_USE_INDEX = YES
HOME_IGNORE_LIMITS = YES
HOME_SEQUENCE = 2
# backlash ballscrew 0.02
BACKLASH=0.085

#********************
# Axis Y
#********************
[AXIS_Y]
MIN_LIMIT = 0.50
#MAX_LIMIT = 235
MAX_LIMIT = 205
#MAX_VELOCITY = 333.333333333 19000mm/min
MAX_VELOCITY = 100.0
MAX_ACCELERATION = 1000.0

[JOINT_1]
TYPE = LINEAR
FERROR = 0.5
MIN_FERROR = 0.05
#MAX_VELOCITY = 333.333333333 19000mm/min
MAX_VELOCITY = 100.0
#MAX_ACCELERATION = 2500.0
MAX_ACCELERATION = 1000.0
# The values below should be 25% larger than MAX_VELOCITY and MAX_ACCELERATION
# If using BACKLASH compensation STEPGEN_MAXACCEL should be 100% larger.
STEPGEN_MAXVEL = 616.7
STEPGEN_MAXACCEL = 6075.0
# these are in nanoseconds
DIRSETUP   = 200
DIRHOLD    = 200
STEPLEN    = 200
STEPSPACE  = 200
# step scale calculation 1024*8200/8192 * 2 (ratio 2:1) / 5 (ballscrew pitch)
STEP_SCALE = 410.0
MIN_LIMIT = 0.50
MAX_LIMIT = 205
#MAX_LIMIT = 236.5
HOME = 120.0
HOME_OFFSET = 0.0
HOME_SEARCH_VEL = -40.000000
HOME_LATCH_VEL = 0.5
HOME_FINAL_VEL = 70.000000
HOME_USE_INDEX = YES
HOME_IGNORE_LIMITS = YES
HOME_SEQUENCE = 1
# backlash ballscrew 0.04
BACKLASH=0.12


#********************
# Axis Z
#********************
[AXIS_Z]
MIN_LIMIT = -437.00
MAX_LIMIT = 1
#MAX_VELOCITY = 333.333333333 19000mm/min
MAX_VELOCITY = 100.0
MAX_ACCELERATION = 1000.0

[JOINT_2]
TYPE = LINEAR
FERROR = 0.5
MIN_FERROR = 0.05
#MAX_VELOCITY = 333.333333333 19000mm/min
MAX_VELOCITY = 100.0
MAX_ACCELERATION = 1000.0
#MAX_ACCELERATION = 2500.0
# The values below should be 25% larger than MAX_VELOCITY and MAX_ACCELERATION
# If using BACKLASH compensation STEPGEN_MAXACCEL should be 100% larger.
STEPGEN_MAXVEL = 616.7
STEPGEN_MAXACCEL = 6075.0
# these are in nanoseconds
DIRSETUP   = 400
DIRHOLD    = 400
STEPLEN    = 400
STEPSPACE  = 400
# motor pulley 36, ballscrew pulley 30
# step scale calculation 2048*8160/8192 * 0.83(3) (ratio 1:0.83(3)) / 5 (ballscrew pitch)
STEP_SCALE = -338.64
#STEP_SCALE = -409.6
#STEP_SCALE = -102.4
# 0.00245941957 mm/rev
MIN_LIMIT = -437.00
MAX_LIMIT = 1
HOME = 0.0
HOME_OFFSET = 3.0
HOME_SEARCH_VEL = 40.000000
HOME_LATCH_VEL = -0.5
HOME_FINAL_VEL = 70.000000
HOME_USE_INDEX = YES
HOME_IGNORE_LIMITS = YES
HOME_SEQUENCE = 0
#BACKLASH=0.07


#********************
# Axis A
#********************
[AXIS_A]
MIN_LIMIT = -30
MAX_LIMIT = 120
MAX_VELOCITY = 100.0
MAX_ACCELERATION = 200.0
WRAPPED_ROTARY=0

[JOINT_3]
TYPE = ANGULAR
WRAPPED_ROTARY=0
HOME = 0.0
FERROR = 0.5
MIN_FERROR = 0.05
MAX_VELOCITY = 100.0
MAX_ACCELERATION = 200.0
# The values below should be 25% larger than MAX_VELOCITY and MAX_ACCELERATION
# If using BACKLASH compensation STEPGEN_MAXACCEL should be 100% larger.
STEPGEN_MAXVEL = 550.0
STEPGEN_MAXACCEL = 6000.0
# these are in nanoseconds
DIRSETUP   = 400
DIRHOLD    = 400
STEPLEN    = 400
STEPSPACE  = 400
# harmonic drive 1:100 
# Amplifier imp / 4096 x 8192 / 8100 = 4050
# step scale calculation 4050*100=405000
#												 405000 / 360 = 1125 steps/degree = 6 sec of a degree per step
STEP_SCALE = 1125
#MIN_LIMIT = -360
#MAX_LIMIT = 360
MIN_LIMIT = -31
MAX_LIMIT = 120
#HOME_OFFSET = -34.475
#HOME_SEARCH_VEL = -40.0
#HOME_LATCH_VEL = 0.5
#HOME_FINAL_VEL = 100.000000
#HOME_USE_INDEX = YES
#HOME_IGNORE_LIMITS = YES
#HOME_SEQUENCE = 2
BACKLASH = 0.0
HOME_OFFSET = 0.0
HOME_SEARCH_VEL = 0.0
HOME_LATCH_VEL = 0.0
HOME_FINAL_VEL = 0.000000
HOME_SEQUENCE = -1

#********************
# Axis B/C
#********************
[AXIS_C]
MIN_LIMIT = -360000
MAX_LIMIT = 360000
MAX_VELOCITY = 100.0
MAX_ACCELERATION = 500.0
WRAPPED_ROTARY=0

[JOINT_4]
TYPE = ANGULAR
WRAPPED_ROTARY=0
HOME = 0.0
FERROR = 0.5
MIN_FERROR = 0.05
MAX_VELOCITY = 100.0
MAX_ACCELERATION = 500.0
# The values below should be 25% larger than MAX_VELOCITY and MAX_ACCELERATION
# If using BACKLASH compensation STEPGEN_MAXACCEL should be 100% larger.
STEPGEN_MAXVEL = 550.0
STEPGEN_MAXACCEL = 6000.0
# these are in nanoseconds
DIRSETUP   = 400
DIRHOLD    = 400
STEPLEN    = 400
STEPSPACE  = 400
# harmonic drive 1:50 
# Amplifier imp / 4096 x 8192 / 8568 = 4284
# step scale calculation 4284*50=2014200
#												 2014200 / 360 = 595 steps/degree = 12 sec of a degree per step
STEP_SCALE = 595
MIN_LIMIT = -360000
MAX_LIMIT = 360000
HOME_OFFSET = -8.530
HOME_SEARCH_VEL = -40.0
HOME_LATCH_VEL = 0.5
HOME_FINAL_VEL = 100.000000
HOME_USE_INDEX = YES
HOME_IGNORE_LIMITS = YES
HOME_SEQUENCE = 2
BACKLASH = 0.0


#********************
# Axis U
#********************
[AXIS_U]
MIN_LIMIT = -360000
MAX_LIMIT = 360000
MAX_VELOCITY = 300.0
MAX_ACCELERATION = 50.0
WRAPPED_ROTARY=0

[JOINT_5]
WRAPPED_ROTARY=0
TYPE = ANGULAR
HOME = 0.0
FERROR = 999999
MIN_FERROR = 999999
MAX_VELOCITY = 300.0
MAX_ACCELERATION = 50.0
MIN_LIMIT = -360000
MAX_LIMIT = 360000
HOME_OFFSET = -8.4
HOME_SEARCH_VEL = -10.0
HOME_LATCH_VEL = 1
HOME_FINAL_VEL = 30.000000
HOME_USE_INDEX = YES
HOME_IGNORE_LIMITS = YES
HOME_SEQUENCE = 0
BACKLASH = 0.0


#********************
# Axis V
#********************
[AXIS_V]
MIN_LIMIT = -360000
MAX_LIMIT = 360000
MAX_VELOCITY = 300.0
MAX_ACCELERATION = 50.0
WRAPPED_ROTARY=0

[JOINT_6]
WRAPPED_ROTARY=0
TYPE = ANGULAR
HOME = 0.0
FERROR = 999999
MIN_FERROR = 999999
MAX_VELOCITY = 300.0
MAX_ACCELERATION = 50.0
MIN_LIMIT = -360000
MAX_LIMIT = 360000
HOME_OFFSET = -16.5
HOME_SEARCH_VEL = -10.0
HOME_LATCH_VEL = 1
HOME_FINAL_VEL = 30.000000
HOME_USE_INDEX = YES
HOME_IGNORE_LIMITS = YES
HOME_SEQUENCE = 0
BACKLASH = 0.0


#HOME_OFFSET = 0
#HOME_SEARCH_VEL = 0.0
#HOME_LATCH_VEL = 0
#HOME_FINAL_VEL = 0.000000
#HOME_USE_INDEX = NO
#HOME_IGNORE_LIMITS = YES
#HOME_SEQUENCE = 0



#********************
# Spindle 
#********************
[TOOLSENSOR]
X=4
Y=200
Z=-460
MAXPROBE=-20
RAPID_SPEED=1000

[PROBE]
BALL_DIAMETER=5.99
BACKOFF=1.5
RAPID_FEED=1500
COARSE_FEED=500
FINE_FEED=15
TOOL_NUMBER=276

[TOOLSETTER]
X=4.313
Y=128.371
Z=-430
TOOLSETTER_DIAM=12.7
TOOLSETTER_FLAT_DIAM=8
TOOLSETTER_HEIGHT=14
REF_TOOL=277
BACKOFF=1
Z_CLEARANCE=2
SAFE_HEIGHT=50
RAPID_FEED=1500

COARSE_RPM=500
COARSE_FEED=300

FINE_RPM=1500
# to calculate fine feed: feed (mm/min/rot) = precision * spindle rpm
PRECISION=0.005

[CHANGE_POSITION]
#X=20
#Y=20
Z=-85

[HOSTMOT2]
# **** This is for info only ****
# DRIVER0=hm2_pci
# BOARD0=5i25


[SPINDLE_1]
P = 1000.0
I = 10.0
D = 0.0
FF0 = 0.0
FF1 = 1.0
FF2 = 0.0
BIAS = 0.0
DEADBAND = 0.0
MAX_OUTPUT = 100.0
MAXI=10
MAXD=10
MAXERROR=10
MIN_SPEED=-8000
MAX_SPEED=8000

[XHC_HB04_CONFIG]
# specify layout = n for LIB:xhc-hb04-layout{n}.cfg files
layout = 2
# coords: specify upto 4 letters from set {x y z a b c u v w}
# coords: switch labels are xyza but any unique 4 letters
#         from the set {xyxabcuvw) can be used (if the coord exists)
coords = x y z a
# lowpass settings:
# coef: slows rate of change of output,  range: 0 < coef < 1
coefs = 0.008 0.008 0.008 0.008
# scale plus or minus, rotaries may require larger scale factor:
scales = 1 -1 1 10 
# jogmode normal(default) or vnormal or plus-minus
jogmode = normal
# sequence 1: 0.001,0.010,0.100,1.000 (mm-based machine)
# sequence 2: 0.001,0.005,0.010,0.020 (inch-based machine)
# sequence 3: 0.001,0.010,0.100
# sequence 4: 0.001,0.005,0.010,0.020,0.050,0.100
# sequence 5: 0.001,0.010,0.050,0.100,1.000
sequence = 1
# require_pendant = no: create xhc-hb04 hal pins when pendant not connecte
#                       at startup
require_pendant = no
# inch_or_mm = in | mm
inch_or_mm = mm
# mpg_accels: provision for reduced acceleration for mpg jogging
mpg_accels = 2000 2000 1000 200

#### see layout2.inc ####[XHC_HB04_BUTTONS]

[APPLICATIONS]
APP = monitor-xhc-hb04
